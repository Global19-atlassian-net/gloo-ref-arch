title: Extend the monolith with a new microservice
description:
  - >
    We want to modify the application's "vets" page, to include a new column in the table indicating the location
    of the vet. We will solve this by deploying a new microservice that serves the updated version of that page, and
    then add a route to Gloo so that requests for the `/vets` path will be routed to the new microservice.
steps:
  - apply:
      manifest:
        path: https://raw.githubusercontent.com/sololabs/demos/b523571c66057a5591bce22ad896729f1fee662b/petclinic_demo/petclinic-vets.yaml
      values:
        Namespace: default
    description:
      - >
        We can use this command to deploy the microservice to Kubernetes.
  - apply:
      manifest:
        path: vs-2.yaml
    title: Deploy the new route to Gloo
    description:
      - >
        Now that the vets microservice is deployed, we can route requests to the vets page to this service. For all other requests,
        we can continue to route the request to the monolith. So we update the `petclinic` virtual service
        with this new route.
    docsValues:
      RenderAsYaml: "true"
  - curl:
      path: /vets.html
      statusCode: 200
      responseBodySubstring: Boston
      service:
        name: gateway-proxy
        namespace: gloo-system
    title: Test the new route
    description:
      - >
        The gateway proxy is still port-forwarded from before. In the browser, navigate to `localhost:8080/vets.html`
        and the vets table should now have a new location column.
      - |
        We can also validate with a curl command that a request to that page contains some of the new data.

        `curl -s localhost:8080/vets.html | grep Boston | wc -l`

        This should return 1. One of the vets in the table now includes a location of Boston.
