steps:
  - patch:
      path: settings-patch.yaml
      kubeType: settings
      name: default
      namespace: gloo-system
      patchType: merge
  - apply:
      manifest:
        path: vs-petstore-2.yaml
  - curl:
      path: /sample-route-1
      statusCode: 429
      service:
        name: gateway-proxy
        namespace: gloo-system
      headers:
        x-type: "Messenger"
        x-number: "311"
  - curl:
      path: /sample-route-1
      statusCode: 429
      service:
        name: gateway-proxy
        namespace: gloo-system
      headers:
        x-type: "Whatsapp"
        x-number: "311"
  - curl:
      path: /sample-route-1
      statusCode: 200
      service:
        name: gateway-proxy
        namespace: gloo-system
      headers:
        x-type: "Whatsapp"
        x-number: "411"